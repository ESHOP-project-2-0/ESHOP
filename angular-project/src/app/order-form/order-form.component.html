<title>Vytvorenie objednávky</title>
<div class="order-form-component">
    <form class="order-form" [formGroup]="orderForm" (ngSubmit)="submitOrder()">
        <div class="title-date">
            <h1>Vytvoriť objednávku č. {{orderId}}</h1>
            <p>{{currentDate}}</p>
        </div>
        <div class="delivery-payment-discount">
            <div class="form-group">
                <label for="deliveryOptions" class="form-label">Spôsob dopravy*</label>
                <div class="delivery-options-wrapper">
                    <select formControlName="deliveryOption" id="deliveryOptions" class="form-control" [ngClass]="{'is-invalid': orderForm.get('deliveryOption').invalid && orderForm.get('deliveryOption').touched}">
                        <option selected disabled>Zvoliť možnosť</option>
                        <option value="kurier">Kuriér</option>
                        <option value="osobny-odber">Osobný odber</option>
                    </select>
                    <div class="delivery-price">
                        <p>0€</p>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="paymentOptions" class="form-label">Spôsob platby*</label>
                <div class="payment-options-wrapper">
                    <select formControlName="paymentOption" id="paymentOptions" class="form-control" [ngClass]="{'is-invalid': orderForm.get('paymentOption').invalid && orderForm.get('paymentOption').touched}">
                        <option selected disabled>Zvoliť možnosť</option>
                        <option value="hotovost">Hotovosť</option>
                        <option value="bankovy-prevod">Bankový prevod</option>
                    </select>
                    <div class="payment-price">
                        <p>0€</p>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label for="discountAmount" class="form-label">Zľava (%)</label>
                <div class="discount-input">
                  <input formControlName="discountAmount" type="number" id="discountAmount" class="form-control" min="0" max="100" placeholder="Zadajte zľavu">
                  <p>% (-0€)</p>
                </div>
            </div>
        </div>

        <div class="total-price">
            <p>CELKOM</p>
            <p>0€</p>
        </div>

        <div class="form-grid">
        <div class="customer-info">
            <h3>Objednávateľ</h3>
            <div class="field">
                <label for="name" class="form-label">Meno a priezvisko*</label>
                <input formControlName="name" type="text" id="name" class="form-control" placeholder="Zadajte meno" [ngClass]="{'is-invalid': orderForm.get('name').invalid && orderForm.get('name').touched}">
            </div>
            <div class="field">
                <label for="company" class="form-label">Firma</label>
                <input formControlName="company" type="text" id="company" class="form-control" placeholder="Zadajte názov firmy">
            </div>
            <div class="field">
                <label for="ico" class="form-label">IČO (povinné v prípade firmy)</label>
                <input formControlName="ico" type="text" id="ico" class="form-control" placeholder="Zadajte IČO">
            </div>
            <div class="field">
                <label for="dic" class="form-label">DIČ (povinné v prípade firmy)</label>
                <input formControlName="dic" type="text" id="dic" class="form-control" placeholder="Zadajte DIČ">
            </div>
            <div class="field">
                <label for="icDph" class="form-label">IČ DPH (ak má firma)</label>
                <input formControlName="icDph" type="text" id="icDph" class="form-control" placeholder="Zadajte IČ DPH">
            </div>
            <div class="field">
                <label for="address" class="form-label">Adresa*</label>
                <input formControlName="address" type="text" id="address" class="form-control" placeholder="Zadajte adresu" [ngClass]="{'is-invalid': orderForm.get('address').invalid && orderForm.get('address').touched}">
            </div>
            <div class="field">
                <label for="city" class="form-label">Mesto*</label>
                <input formControlName="city" type="text" id="city" class="form-control" placeholder="Zadajte mesto" [ngClass]="{'is-invalid': orderForm.get('city').invalid && orderForm.get('city').touched}">
            </div>
            <div class="field">
                <label for="postalCode" class="form-label">PSČ*</label>
                <input formControlName="postalCode" type="text" id="postalCode" class="form-control" placeholder="Zadajte PSČ" [ngClass]="{'is-invalid': orderForm.get('postalCode').invalid && orderForm.get('postalCode').touched}">
            </div>
            <div class="field">
                <label for="email" class="form-label">E-mailová adresa*</label>
                <input formControlName="email" type="email" id="email" class="form-control" placeholder="Zadajte e-mailovú adresu" [ngClass]="{'is-invalid': orderForm.get('email').invalid && orderForm.get('email').touched}">
            </div>
            <div class="field">
                <label for="phoneNumber" class="form-label">Telefónne číslo*</label>
                <input formControlName="phoneNumber" type="text" id="phoneNumber" class="form-control" placeholder="Zadajte telefónne číslo" [ngClass]="{'is-invalid': orderForm.get('phoneNumber').invalid && orderForm.get('phoneNumber').touched}">
            </div>
            <div class="field">
                <label for="note" class="form-label">Poznámka</label>
                <textarea formControlName="note" name="note" id="note" class="form-control" placeholder="Napíšte poznámku" minlength="0" maxlength="250" [(ngModel)]="userMessage" (input)="update()"></textarea>
                @if(userMessage.length > 0){
                    <div class="char-count">{{ charactersCount }} / 250 písmen</div>
                }
                @else{
                    
                }
            </div>
        </div>
        <div class="invoice-settings">
            <h3>Nastavenia faktúry</h3>
            <form [formGroup]="invoiceForm" (ngSubmit)="createInvoice()">
              <div class="field">
                <label for="invoiceNumber" class="form-label">Číslo faktúry*</label>
                <input type="number" id="invoiceNumber" class="form-control" value="{{orderId}}" readonly placeholder="Zadajte číslo faktúry" formControlName="invoiceNumber" [ngClass]="{'is-invalid': invoiceForm.get('invoiceNumber').invalid && invoiceForm.get('invoiceNumber').touched}">
            </div>
            <div class="field">
                <label for="variableSymbol" class="form-label">Variabilný symbol* (Ak je iný ako číslo faktúry)</label>
                <input type="text" id="variableSymbol" class="form-control" value="{{orderId}}" placeholder="Zadajte variabilný symbol" formControlName="invoiceVariable" [ngClass]="{'is-invalid': invoiceForm.get('invoiceVariable').invalid && invoiceForm.get('invoiceVariable').touched}">
            </div>
            <div class="field">
                <label for="documentType">Typ dokladu*</label>
                <input id="documentType" class="form-control" value="Faktúra" readonly placeholder="Typ dokladu (Faktúra)">
            </div>
            <div class="field">
                <label for="invoiceIssueDate" class="form-label">Dátum vystavenia faktúry*</label>
                <input type="date" id="invoiceIssueDate" class="form-control" placeholder="Vyberte dátum splatnosti" formControlName="invoiceIssueDate">
            </div>
            <div class="field">
                <label for="dueDate" class="form-label">Dátum splatnosti*</label>
                <input type="date" id="dueDate" class="form-control" placeholder="Vyberte dátum splatnosti" formControlName="invoiceDueDate">
            </div>
            <div class="field">
                <label for="deliveryDate" class="form-label">Dátum dodania*</label>
                <input type="date" id="deliveryDate" class="form-control" placeholder="Vyberte dátum dodania" formControlName="invoiceDeliveryDate">
            </div>
            <div class="field">
              <label for="invoiceName" class="form-label">Meno a priezvisko*</label>
              <input type="text" id="invoiceName" class="form-control" placeholder="Zadajte meno a priezvisko na faktúre" formControlName="invoiceName" [ngClass]="{'is-invalid': invoiceForm.get('invoiceName').invalid && invoiceForm.get('invoiceName').touched}">
            </div>
            <div class="field">
              <label for="invoiceCompany" class="form-label">Firma</label>
              <input type="text" id="invoiceCompany" class="form-control" placeholder="Zadajte názov firmy na faktúre" formControlName="invoiceCompany">
            </div>
            <div class="field">
              <label for="invoiceICO" class="form-label">IČO (povinné v prípade firmy)</label>
              <input type="text" id="invoiceICO" class="form-control" placeholder="Zadajte IČO" formControlName="invoiceICO">
            </div>
            <div class="field">
              <label for="invoiceDIC" class="form-label">DIČ (povinné v prípade firmy)</label>
              <input type="text" id="invoiceDIC" class="form-control" placeholder="Zadajte DIČ" formControlName="invoiceDIC">
            </div>
            <div class="field">
              <label for="invoiceEmail" class="form-label">E-mailová adresa*</label>
              <input type="text" id="invoiceEmail" class="form-control" placeholder="Zadajte e-malovú adresu na faktúre" formControlName="invoiceEmail" [ngClass]="{'is-invalid': invoiceForm.get('invoiceEmail').invalid && invoiceForm.get('invoiceEmail').touched}">
            </div>
            <div class="field">
              <label for="invoicePhoneNumber" class="form-label">Telefónne číslo*</label>
              <input type="text" id="invoicePhoneNumber" class="form-control" placeholder="Zadajte telefónne číslo na faktúre" formControlName="invoicePhoneNumber" [ngClass]="{'is-invalid': invoiceForm.get('invoicePhoneNumber').invalid && invoiceForm.get('invoicePhoneNumber').touched}">
            </div>
            <div class="field">
              <label>Pred vytvorením faktúry overte, či zadané údaje sú správne</label><br>
              <button class="create-invoice-btn btn btn-secondary" id="create-invoice-btn" (click)="createInvoice()">Vytvoriť faktúru</button>
            </div>
            </form>
        </div>
    </div>

    <div class="order-status">
        <div class="status-form-grid">
            <div class="status-container-with-email">
              <h3>Stav objednávky<br><div class="default-container">
                <label class="default-status">Bez výberu: 
                  <input formControlName="orderStatus" type="radio" class="form-check-input" value="nezpracovane-nova-objednavka" checked>
                  Nezpracované - nová objednávka
                </label>
              </div>
            </h3>
                <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="vybavit-posta">
                      Vybaviť - Pošta
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="uhradene-vybavit">
                      Uhradené - Vybaviť 
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="neuhradene-cakam-na-platbu">
                      Neuhradené, čakám na platbu
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="neuhradene-udaje-k-platbe-poslat-zakaznikovi-mail">
                      Neuhradené - Údaje k platbe, poslať zákazníkovi e-mail
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="neuhradene-2xmail-poslany-zakaznikovi">
                      Neuhradené - 2x poslaný e-mail zákazníkovi
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="vybavit-odlozene-osobny-odber">
                      Vybaviť - Odložené, osobný odber
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="poslane-neuhradene">
                      Poslané, neuhradené
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="dobierka-info-k-objednavke-mail">
                      Dobierka - Info k objednávke (poslať zákazníkovi e-mail)
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="zasielanie-cisla-zasielky-posta-mail">
                      Zasielanie čísla zásielky (Pošta)
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="oprava">
                      Oprava
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="objednavka-odoslana-cakam-na-uhradu-dobierkou">
                      Objednávka odoslaná, čakám na úhradu dobierkou
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="objednavka-vybavena">
                      Objednávka vybavená
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="storno">
                      Storno
                    </label>
                  </div>
                  <div>
                    <label>
                      <input formControlName="orderStatus" type="radio" class="form-check-input" value="rozbite-znicene-vratene">
                      Rozbité, zničené, vrátené
                    </label>
                  </div>
            </div>
            <div class="order-summary-container">
              <h3>Zhrnutie objednávky<br>
              <span class="order-summary-title-text">Pred vytvorením objednávky skontrolujte zadané údaje</span></h3>
              <div class="order-summary">
                <p><strong>Spôsob dopravy:</strong> {{ orderForm.get('deliveryOption').value || 'Nezvolený' }}</p>
                <p><strong>Spôsob platby:</strong> {{ orderForm.get('paymentOption').value || 'Nezvolený' }}</p>
                <p><strong>Meno:</strong> {{ orderForm.get('name').value || 'Nezadané' }}</p>
                <p><strong>Firma:</strong> {{ orderForm.get('company').value || 'Nezadané' }}</p>
                <p><strong>IČO:</strong> {{ orderForm.get('ico').value || 'Nezadané' }}</p>
                <p><strong>DIČ:</strong> {{ orderForm.get('dic').value || 'Nezadané' }}</p>
                <p><strong>IČ DPH:</strong> {{ orderForm.get('icDph').value || 'Nezadané' }}</p>
                <p><strong>Adresa:</strong> {{ orderForm.get('address').value || 'Nezadané' }}</p>
                <p><strong>Mesto:</strong> {{ orderForm.get('city').value || 'Nezadané' }}</p>
                <p><strong>PSČ:</strong> {{ orderForm.get('postalCode').value || 'Nezadané' }}</p>
                <p><strong>E-mailová adresa:</strong> {{ orderForm.get('email').value || 'Nezadané' }}</p>
                <p><strong>Telefónne číslo:</strong> {{ orderForm.get('phoneNumber').value || 'Nezadané' }}</p>
                <p><strong>Stav:</strong> {{ orderForm.get('orderStatus').value || 'Bez výberu' }}</p>
                <p><strong>Celková cena:</strong> 0€ (-{{orderForm.get('discountAmount').value}}%)</p> <!-- Tento údaj bude dynamicky vypočítaný na základe ďalších polí -->
              </div>
            </div>
        </div>
    </div>

        <div class="submit">
            <button type="submit" class="btn btn-primary">Vytvoriť objednávku</button>
        </div>
    </form>
</div>